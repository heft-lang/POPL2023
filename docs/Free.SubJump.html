<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Free.SubJump</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">{-
The sub/jump operations due to Thielecke and Fiore and Staton.

Implementation in terms of free monad is due to Schrijvers, Piróg, Wu, and Jaskelioff.
-}</a>
<a id="158" class="Keyword">module</a> <a id="165" href="Free.SubJump.html" class="Module">Free.SubJump</a> <a id="178" class="Keyword">where</a>

<a id="185" class="Keyword">open</a> <a id="190" class="Keyword">import</a> <a id="197" href="Function.html" class="Module">Function</a>
<a id="206" class="Keyword">open</a> <a id="211" class="Keyword">import</a> <a id="218" href="Level.html" class="Module">Level</a> <a id="224" class="Keyword">using</a> <a id="230" class="Symbol">(</a><a id="231" href="Agda.Primitive.html#764" class="Primitive">zero</a><a id="235" class="Symbol">)</a>
<a id="237" class="Keyword">open</a> <a id="242" class="Keyword">import</a> <a id="249" href="Data.Unit.html" class="Module">Data.Unit</a>
<a id="259" class="Keyword">open</a> <a id="264" class="Keyword">import</a> <a id="271" href="Data.Empty.html" class="Module">Data.Empty</a>
<a id="282" class="Keyword">open</a> <a id="287" class="Keyword">import</a> <a id="294" href="Data.Sum.html" class="Module">Data.Sum</a>
<a id="303" class="Keyword">open</a> <a id="308" class="Keyword">import</a> <a id="315" href="Data.Universe.html" class="Module">Data.Universe</a> <a id="329" class="Keyword">renaming</a> <a id="338" class="Symbol">(</a><a id="339" href="Data.Universe.html#396" class="Record">Universe</a> <a id="348" class="Symbol">to</a> <a id="351" class="Record">Univ</a><a id="355" class="Symbol">)</a>
<a id="357" class="Keyword">private</a> <a id="Universe"></a><a id="365" href="Free.SubJump.html#365" class="Function">Universe</a> <a id="374" class="Symbol">=</a> <a id="376" href="Free.SubJump.html#351" class="Record">Univ</a> <a id="381" href="Agda.Primitive.html#764" class="Primitive">zero</a> <a id="386" href="Agda.Primitive.html#764" class="Primitive">zero</a>
<a id="391" class="Keyword">open</a> <a id="396" href="Free.SubJump.html#351" class="Module">Univ</a> <a id="401" class="Symbol">⦃</a> <a id="403" class="Symbol">...</a> <a id="407" class="Symbol">⦄</a> <a id="409" class="Keyword">renaming</a> <a id="418" class="Symbol">(</a><a id="419" href="Data.Universe.html#447" class="Field">U</a> <a id="421" class="Symbol">to</a> <a id="424" class="Field">T</a><a id="425" class="Symbol">;</a> <a id="427" href="Data.Universe.html#477" class="Field">El</a> <a id="430" class="Symbol">to</a> <a id="433" class="Field">⟦_⟧</a><a id="436" class="Symbol">)</a>

<a id="439" class="Keyword">open</a> <a id="444" class="Keyword">import</a> <a id="451" href="Free.html" class="Module">Free</a>

<a id="457" class="Comment">{-
Operations
-}</a>

<a id="475" class="Keyword">data</a> <a id="CCOp"></a><a id="480" href="Free.SubJump.html#480" class="Datatype">CCOp</a> <a id="485" class="Symbol">⦃</a> <a id="487" href="Free.SubJump.html#487" class="Bound">u</a> <a id="489" class="Symbol">:</a> <a id="491" href="Free.SubJump.html#365" class="Function">Universe</a> <a id="500" class="Symbol">⦄</a> <a id="502" class="Symbol">(</a><a id="503" href="Free.SubJump.html#503" class="Bound">Ref</a> <a id="507" class="Symbol">:</a> <a id="509" href="Free.SubJump.html#424" class="Field">T</a> <a id="511" class="Symbol">→</a> <a id="513" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="516" class="Symbol">)</a> <a id="518" class="Symbol">:</a> <a id="520" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="524" class="Keyword">where</a>
  <a id="CCOp.sub"></a><a id="532" href="Free.SubJump.html#532" class="InductiveConstructor">sub</a>   <a id="538" class="Symbol">:</a> <a id="540" class="Symbol">{</a><a id="541" href="Free.SubJump.html#541" class="Bound">t</a> <a id="543" class="Symbol">:</a> <a id="545" href="Free.SubJump.html#424" class="Field">T</a><a id="546" class="Symbol">}</a>                           <a id="574" class="Symbol">→</a>  <a id="577" href="Free.SubJump.html#480" class="Datatype">CCOp</a> <a id="582" href="Free.SubJump.html#503" class="Bound">Ref</a>
  <a id="CCOp.jump"></a><a id="588" href="Free.SubJump.html#588" class="InductiveConstructor">jump</a>  <a id="594" class="Symbol">:</a> <a id="596" class="Symbol">{</a><a id="597" href="Free.SubJump.html#597" class="Bound">t</a> <a id="599" class="Symbol">:</a> <a id="601" href="Free.SubJump.html#424" class="Field">T</a><a id="602" class="Symbol">}</a> <a id="604" class="Symbol">(</a><a id="605" href="Free.SubJump.html#605" class="Bound">ref</a> <a id="609" class="Symbol">:</a> <a id="611" href="Free.SubJump.html#503" class="Bound">Ref</a> <a id="615" href="Free.SubJump.html#597" class="Bound">t</a><a id="616" class="Symbol">)</a> <a id="618" class="Symbol">(</a><a id="619" href="Free.SubJump.html#619" class="Bound">x</a> <a id="621" class="Symbol">:</a> <a id="623" href="Free.SubJump.html#433" class="Field Operator">⟦</a> <a id="625" href="Free.SubJump.html#597" class="Bound">t</a> <a id="627" href="Free.SubJump.html#433" class="Field Operator">⟧</a><a id="628" class="Symbol">)</a> <a id="630" class="Symbol">→</a>  <a id="633" href="Free.SubJump.html#480" class="Datatype">CCOp</a> <a id="638" href="Free.SubJump.html#503" class="Bound">Ref</a>


<a id="644" class="Comment">{-
Effect signature
-}</a>

<a id="CC"></a><a id="668" href="Free.SubJump.html#668" class="Function">CC</a> <a id="671" class="Symbol">:</a> <a id="673" class="Symbol">⦃</a> <a id="675" href="Free.SubJump.html#675" class="Bound">u</a> <a id="677" class="Symbol">:</a> <a id="679" href="Free.SubJump.html#365" class="Function">Universe</a> <a id="688" class="Symbol">⦄</a> <a id="690" class="Symbol">(</a><a id="691" href="Free.SubJump.html#691" class="Bound">Ref</a> <a id="695" class="Symbol">:</a> <a id="697" href="Free.SubJump.html#424" class="Field">T</a> <a id="699" class="Symbol">→</a> <a id="701" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="704" class="Symbol">)</a> <a id="706" class="Symbol">→</a> <a id="708" href="Free.html#787" class="Record">Effect</a>
<a id="715" href="Free.html#816" class="Field">Op</a>  <a id="719" class="Symbol">(</a><a id="720" href="Free.SubJump.html#668" class="Function">CC</a> <a id="723" href="Free.SubJump.html#723" class="Bound">Ref</a><a id="726" class="Symbol">)</a> <a id="728" class="Symbol">=</a> <a id="730" href="Free.SubJump.html#480" class="Datatype">CCOp</a> <a id="735" href="Free.SubJump.html#723" class="Bound">Ref</a>
<a id="739" href="Free.html#836" class="Field">Ret</a> <a id="743" class="Symbol">(</a><a id="744" href="Free.SubJump.html#668" class="Function">CC</a> <a id="747" href="Free.SubJump.html#747" class="Bound">Ref</a><a id="750" class="Symbol">)</a> <a id="752" class="Symbol">(</a><a id="753" href="Free.SubJump.html#532" class="InductiveConstructor">sub</a> <a id="757" class="Symbol">{</a><a id="758" href="Free.SubJump.html#758" class="Bound">t</a><a id="759" class="Symbol">})</a>         <a id="770" class="Symbol">=</a> <a id="772" href="Free.SubJump.html#747" class="Bound">Ref</a> <a id="776" href="Free.SubJump.html#758" class="Bound">t</a> <a id="778" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="780" href="Free.SubJump.html#433" class="Field Operator">⟦</a> <a id="782" href="Free.SubJump.html#758" class="Bound">t</a> <a id="784" href="Free.SubJump.html#433" class="Field Operator">⟧</a>
<a id="786" href="Free.html#836" class="Field">Ret</a> <a id="790" class="Symbol">(</a><a id="791" href="Free.SubJump.html#668" class="Function">CC</a> <a id="794" href="Free.SubJump.html#794" class="Bound">Ref</a><a id="797" class="Symbol">)</a> <a id="799" class="Symbol">(</a><a id="800" href="Free.SubJump.html#588" class="InductiveConstructor">jump</a> <a id="805" href="Free.SubJump.html#805" class="Bound">ref</a> <a id="809" href="Free.SubJump.html#809" class="Bound">x</a><a id="810" class="Symbol">)</a>  <a id="813" class="Symbol">=</a> <a id="815" href="Data.Empty.html#886" class="Function">⊥</a>


<a id="819" class="Comment">{-
Smart constructors
-}</a>
<a id="844" class="Keyword">module</a> <a id="851" href="Free.SubJump.html#851" class="Module">_</a> <a id="853" class="Symbol">⦃</a> <a id="855" href="Free.SubJump.html#855" class="Bound">u</a> <a id="857" class="Symbol">:</a> <a id="859" href="Free.SubJump.html#365" class="Function">Universe</a> <a id="868" class="Symbol">⦄</a> <a id="870" class="Symbol">{</a><a id="871" href="Free.SubJump.html#871" class="Bound">Ref</a> <a id="875" class="Symbol">:</a> <a id="877" href="Free.SubJump.html#424" class="Field">T</a> <a id="879" class="Symbol">→</a> <a id="881" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="884" class="Symbol">}</a> <a id="886" class="Symbol">⦃</a> <a id="888" href="Free.SubJump.html#888" class="Bound">w</a> <a id="890" class="Symbol">:</a> <a id="892" href="Free.html#882" class="Generalizable">Δ</a> <a id="894" href="Free.html#3485" class="Datatype Operator">∼</a> <a id="896" href="Free.SubJump.html#668" class="Function">CC</a> <a id="899" href="Free.SubJump.html#871" class="Bound">Ref</a> <a id="903" href="Free.html#3485" class="Datatype Operator">▸</a> <a id="905" href="Free.html#884" class="Generalizable">Δ′</a> <a id="908" class="Symbol">⦄</a> <a id="910" class="Keyword">where</a>
  <a id="918" href="Free.SubJump.html#918" class="Function">‵sub</a>   <a id="925" class="Symbol">:</a> <a id="927" class="Symbol">{</a><a id="928" href="Free.SubJump.html#928" class="Bound">t</a> <a id="930" class="Symbol">:</a> <a id="932" href="Free.SubJump.html#424" class="Field">T</a><a id="933" class="Symbol">}</a> <a id="935" class="Symbol">→</a> <a id="937" class="Symbol">(</a><a id="938" href="Free.SubJump.html#871" class="Bound">Ref</a> <a id="942" href="Free.SubJump.html#928" class="Bound">t</a> <a id="944" class="Symbol">→</a> <a id="946" href="Free.html#1508" class="Datatype">Free</a> <a id="951" href="Free.SubJump.html#892" class="Bound">Δ</a> <a id="953" href="Free.html#469" class="Generalizable">A</a><a id="954" class="Symbol">)</a> <a id="956" class="Symbol">→</a> <a id="958" class="Symbol">(</a><a id="959" href="Free.SubJump.html#433" class="Field Operator">⟦</a> <a id="961" href="Free.SubJump.html#928" class="Bound">t</a> <a id="963" href="Free.SubJump.html#433" class="Field Operator">⟧</a> <a id="965" class="Symbol">→</a> <a id="967" href="Free.html#1508" class="Datatype">Free</a> <a id="972" href="Free.SubJump.html#892" class="Bound">Δ</a> <a id="974" href="Free.html#469" class="Generalizable">A</a><a id="975" class="Symbol">)</a>  <a id="978" class="Symbol">→</a> <a id="980" href="Free.html#1508" class="Datatype">Free</a> <a id="985" href="Free.SubJump.html#892" class="Bound">Δ</a> <a id="987" href="Free.html#469" class="Generalizable">A</a>
  <a id="991" href="Free.SubJump.html#918" class="Function">‵sub</a> <a id="996" href="Free.SubJump.html#996" class="Bound">b</a> <a id="998" href="Free.SubJump.html#998" class="Bound">k</a> <a id="1000" class="Symbol">=</a> <a id="1002" href="Free.html#1612" class="InductiveConstructor">impure</a>
    <a id="1013" class="Symbol">(</a><a id="1014" href="Free.html#4103" class="Function">inj▸ₗ</a> <a id="1020" class="Symbol">⦃</a> <a id="1022" href="Free.SubJump.html#888" class="Bound">w</a> <a id="1024" class="Symbol">⦄</a> <a id="1026" href="Free.SubJump.html#532" class="InductiveConstructor">sub</a><a id="1029" class="Symbol">)</a>
    <a id="1035" class="Symbol">(</a><a id="1036" href="Data.Sum.Base.html#920" class="Function Operator">[</a> <a id="1038" href="Free.SubJump.html#996" class="Bound">b</a> <a id="1040" href="Data.Sum.Base.html#920" class="Function Operator">,</a> <a id="1042" href="Free.SubJump.html#998" class="Bound">k</a> <a id="1044" href="Data.Sum.Base.html#920" class="Function Operator">]</a> <a id="1046" href="Function.Base.html#1106" class="Function Operator">∘</a>  <a id="1049" href="Free.html#4325" class="Function">proj-ret▸ₗ</a> <a id="1060" class="Symbol">⦃</a> <a id="1062" href="Free.SubJump.html#888" class="Bound">w</a> <a id="1064" class="Symbol">⦄)</a>

  <a id="1070" href="Free.SubJump.html#1070" class="Function">‵jump</a>  <a id="1077" class="Symbol">:</a> <a id="1079" class="Symbol">{</a><a id="1080" href="Free.SubJump.html#1080" class="Bound">t</a> <a id="1082" class="Symbol">:</a> <a id="1084" href="Free.SubJump.html#424" class="Field">T</a><a id="1085" class="Symbol">}</a> <a id="1087" class="Symbol">→</a> <a id="1089" href="Free.SubJump.html#871" class="Bound">Ref</a> <a id="1093" href="Free.SubJump.html#1080" class="Bound">t</a> <a id="1095" class="Symbol">→</a> <a id="1097" href="Free.SubJump.html#433" class="Field Operator">⟦</a> <a id="1099" href="Free.SubJump.html#1080" class="Bound">t</a> <a id="1101" href="Free.SubJump.html#433" class="Field Operator">⟧</a>                            <a id="1130" class="Symbol">→</a> <a id="1132" href="Free.html#1508" class="Datatype">Free</a> <a id="1137" href="Free.SubJump.html#892" class="Bound">Δ</a> <a id="1139" href="Free.html#471" class="Generalizable">B</a>
  <a id="1143" href="Free.SubJump.html#1070" class="Function">‵jump</a> <a id="1149" href="Free.SubJump.html#1149" class="Bound">ref</a> <a id="1153" href="Free.SubJump.html#1153" class="Bound">x</a> <a id="1155" class="Symbol">=</a> <a id="1157" href="Free.html#1612" class="InductiveConstructor">impure</a>
    <a id="1168" class="Symbol">(</a><a id="1169" href="Free.html#4103" class="Function">inj▸ₗ</a> <a id="1175" class="Symbol">(</a><a id="1176" href="Free.SubJump.html#588" class="InductiveConstructor">jump</a> <a id="1181" href="Free.SubJump.html#1149" class="Bound">ref</a> <a id="1185" href="Free.SubJump.html#1153" class="Bound">x</a><a id="1186" class="Symbol">))</a>
    <a id="1193" class="Symbol">(</a><a id="1194" href="Data.Empty.html#1041" class="Function">⊥-elim</a> <a id="1201" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="1203" href="Free.html#4325" class="Function">proj-ret▸ₗ</a> <a id="1214" class="Symbol">⦃</a> <a id="1216" href="Free.SubJump.html#888" class="Bound">w</a> <a id="1218" class="Symbol">⦄)</a>


<a id="1223" class="Comment">{-
Handler
-}</a>

<a id="hCC"></a><a id="1238" href="Free.SubJump.html#1238" class="Function">hCC</a> <a id="1242" class="Symbol">:</a> <a id="1244" class="Symbol">⦃</a> <a id="1246" href="Free.SubJump.html#1246" class="Bound">u</a> <a id="1248" class="Symbol">:</a> <a id="1250" href="Free.SubJump.html#365" class="Function">Universe</a> <a id="1259" class="Symbol">⦄</a> <a id="1261" class="Symbol">→</a> <a id="1263" href="Free.html#7015" class="Record Operator">⟨</a> <a id="1265" href="Free.html#469" class="Generalizable">A</a> <a id="1267" href="Free.html#7015" class="Record Operator">!</a> <a id="1269" class="Symbol">(</a><a id="1270" href="Free.SubJump.html#668" class="Function">CC</a> <a id="1273" class="Symbol">(λ</a> <a id="1276" href="Free.SubJump.html#1276" class="Bound">t</a> <a id="1278" class="Symbol">→</a> <a id="1280" href="Free.SubJump.html#433" class="Field Operator">⟦</a> <a id="1282" href="Free.SubJump.html#1276" class="Bound">t</a> <a id="1284" href="Free.SubJump.html#433" class="Field Operator">⟧</a> <a id="1286" class="Symbol">→</a> <a id="1288" href="Free.html#1508" class="Datatype">Free</a> <a id="1293" href="Free.html#884" class="Generalizable">Δ′</a> <a id="1296" href="Free.html#469" class="Generalizable">A</a><a id="1297" class="Symbol">))</a> <a id="1300" href="Free.html#7015" class="Record Operator">⇒</a> <a id="1302" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a> <a id="1304" href="Free.html#7015" class="Record Operator">⇒</a> <a id="1306" href="Free.html#469" class="Generalizable">A</a> <a id="1308" href="Free.html#7015" class="Record Operator">!</a> <a id="1310" href="Free.html#884" class="Generalizable">Δ′</a> <a id="1313" href="Free.html#7015" class="Record Operator">⟩</a>
<a id="1315" href="Free.html#7106" class="Field">ret</a>  <a id="1320" href="Free.SubJump.html#1238" class="Function">hCC</a> <a id="1324" href="Free.SubJump.html#1324" class="Bound">x</a> <a id="1326" class="Symbol">_</a>                <a id="1343" class="Symbol">=</a> <a id="1345" href="Free.html#1550" class="InductiveConstructor">pure</a> <a id="1350" href="Free.SubJump.html#1324" class="Bound">x</a>
<a id="1352" href="Free.html#7140" class="Field">hdl</a>  <a id="1357" href="Free.SubJump.html#1238" class="Function">hCC</a> <a id="1361" href="Free.SubJump.html#532" class="InductiveConstructor">sub</a>           <a id="1375" href="Free.SubJump.html#1375" class="Bound">k</a> <a id="1377" href="Free.SubJump.html#1377" class="Bound">p</a>  <a id="1380" class="Symbol">=</a> <a id="1382" class="Keyword">let</a> <a id="1386" href="Free.SubJump.html#1386" class="Bound">c</a> <a id="1388" class="Symbol">=</a> <a id="1390" href="Function.Base.html#1629" class="Function">flip</a> <a id="1395" href="Free.SubJump.html#1375" class="Bound">k</a> <a id="1397" href="Free.SubJump.html#1377" class="Bound">p</a> <a id="1399" href="Function.Base.html#1106" class="Function Operator">∘</a> <a id="1401" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="1406" class="Keyword">in</a> <a id="1409" href="Free.SubJump.html#1375" class="Bound">k</a> <a id="1411" class="Symbol">(</a><a id="1412" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="1417" href="Free.SubJump.html#1386" class="Bound">c</a><a id="1418" class="Symbol">)</a> <a id="1420" href="Free.SubJump.html#1377" class="Bound">p</a>
<a id="1422" href="Free.html#7140" class="Field">hdl</a>  <a id="1427" href="Free.SubJump.html#1238" class="Function">hCC</a> <a id="1431" class="Symbol">(</a><a id="1432" href="Free.SubJump.html#588" class="InductiveConstructor">jump</a> <a id="1437" href="Free.SubJump.html#1437" class="Bound">ref</a> <a id="1441" href="Free.SubJump.html#1441" class="Bound">x</a><a id="1442" class="Symbol">)</a>  <a id="1445" href="Free.SubJump.html#1445" class="Bound">k</a> <a id="1447" href="Free.SubJump.html#1447" class="Bound">p</a>  <a id="1450" class="Symbol">=</a> <a id="1452" href="Free.SubJump.html#1437" class="Bound">ref</a> <a id="1456" href="Free.SubJump.html#1441" class="Bound">x</a>

</pre></body></html>